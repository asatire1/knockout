<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padel Tournament Manager</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Tournament fixtures data - 13 rounds, 6 matches per round
        const fixtures = [
            [[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,15,16],[17,18,19,20],[21,22,23,24]],
            [[1,24,10,16],[2,23,11,15],[3,22,12,14],[4,21,9,13],[5,20,8,17],[6,19,7,18]],
            [[1,3,23,21],[2,4,24,22],[5,7,19,17],[6,8,20,18],[9,11,15,13],[10,12,16,14]],
            [[1,22,12,18],[2,21,9,19],[3,24,10,20],[4,23,11,17],[5,14,8,16],[6,13,7,15]],
            [[1,5,20,16],[2,6,19,17],[3,7,22,18],[4,8,21,15],[9,13,24,12],[10,14,23,11]],
            [[1,18,14,24],[2,17,13,23],[3,20,16,22],[4,19,15,21],[5,10,12,8],[6,9,11,7]],
            [[1,15,11,19],[2,16,12,20],[3,13,9,21],[4,14,10,22],[5,23,7,17],[6,24,8,18]],
            [[1,8,6,22],[2,7,5,23],[3,10,8,24],[4,9,7,21],[11,19,15,17],[12,20,16,18]],
            [[1,17,13,21],[2,18,14,22],[3,19,15,23],[4,20,16,24],[5,9,11,7],[6,10,12,8]],
            [[1,12,4,16],[2,11,3,17],[5,24,14,18],[6,23,13,19],[7,22,10,20],[8,21,9,15]],
            [[1,19,7,23],[2,20,8,24],[3,17,5,21],[4,18,6,22],[9,16,12,14],[10,15,11,13]],
            [[1,14,2,13],[3,16,4,15],[5,18,6,17],[7,20,8,19],[9,22,10,21],[11,24,12,23]],
            [[1,11,5,15],[2,12,6,16],[3,9,7,13],[4,10,8,14],[17,21,19,23],[18,22,20,24]]
        ];

        // Default player names
        const defaultPlayerNames = Array.from({length: 24}, (_, i) => `Player ${i + 1}`);

        // Default skill ratings (descending from 3.85 to 2.45)
        const defaultSkillRatings = {};
        for (let i = 1; i <= 24; i++) {
            defaultSkillRatings[i] = 3.85 - ((i - 1) * 0.06);
        }

        function PadelTournamentApp() {
            const [activeTab, setActiveTab] = useState('tournament');
            const [selectedRound, setSelectedRound] = useState(1);
            const [filterRound, setFilterRound] = useState('all');
            const [filterPlayer, setFilterPlayer] = useState('all');
            const [playerNames, setPlayerNames] = useState(defaultPlayerNames);
            const [skillRatings, setSkillRatings] = useState(defaultSkillRatings);
            const [matchScores, setMatchScores] = useState({});
            const [knockoutScores, setKnockoutScores] = useState({});
            const [knockoutMaxScore, setKnockoutMaxScore] = useState(16);
            const [semiMaxScore, setSemiMaxScore] = useState(16);
            const [finalMaxScore, setFinalMaxScore] = useState(16);
            const [savedVersions, setSavedVersions] = useState([]);

            // Helper functions
            const getTierColor = (playerNum) => {
                const tier = Math.ceil(playerNum / 4);
                const colors = ['#DC2626', '#EA580C', '#CA8A04', '#16A34A', '#2563EB', '#7C3AED'];
                return colors[tier - 1];
            };

            const getTierName = (playerNum) => {
                const tier = Math.ceil(playerNum / 4);
                const names = ['Elite', 'Advanced', 'Intermediate+', 'Intermediate', 'Beginner+', 'Beginner'];
                return names[tier - 1];
            };

            const handleScoreChange = (round, matchIdx, team, value) => {
                const score = value === '' ? null : parseInt(value);
                if (score !== null && (score < 0 || score > 16)) return;

                const newScores = { ...matchScores };
                if (!newScores[round]) newScores[round] = {};
                if (!newScores[round][matchIdx]) newScores[round][matchIdx] = {};

                if (team === 'team1') {
                    newScores[round][matchIdx].team1Score = score;
                    newScores[round][matchIdx].team2Score = score !== null ? 16 - score : null;
                } else {
                    newScores[round][matchIdx].team2Score = score;
                    newScores[round][matchIdx].team1Score = score !== null ? 16 - score : null;
                }

                setMatchScores(newScores);
            };

            const clearMatchScore = (round, matchIdx) => {
                const newScores = { ...matchScores };
                if (newScores[round] && newScores[round][matchIdx]) {
                    delete newScores[round][matchIdx];
                }
                setMatchScores(newScores);
            };

            const getFilteredMatches = () => {
                let matches = [];
                
                for (let r = 1; r <= 13; r++) {
                    if (filterRound !== 'all' && parseInt(filterRound) !== r) continue;
                    
                    for (let m = 0; m < 6; m++) {
                        const match = fixtures[r - 1][m];
                        
                        if (filterPlayer !== 'all') {
                            const pNum = parseInt(filterPlayer);
                            if (!match.includes(pNum)) continue;
                        }
                        
                        matches.push({ round: r, matchIndex: m, match });
                    }
                }
                
                return matches;
            };

            const exportData = () => {
                const data = {
                    playerNames,
                    skillRatings,
                    matchScores,
                    knockoutScores,
                    knockoutMaxScore,
                    semiMaxScore,
                    finalMaxScore,
                    savedVersions,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `padel-tournament-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                alert('Data exported successfully!');
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        setPlayerNames(data.playerNames || defaultPlayerNames);
                        setSkillRatings(data.skillRatings || defaultSkillRatings);
                        setMatchScores(data.matchScores || {});
                        setKnockoutScores(data.knockoutScores || {});
                        setKnockoutMaxScore(data.knockoutMaxScore || 16);
                        setSemiMaxScore(data.semiMaxScore || 16);
                        setFinalMaxScore(data.finalMaxScore || 16);
                        setSavedVersions(data.savedVersions || []);
                        alert('Data imported successfully!');
                    } catch (error) {
                        alert('Error importing data. Please make sure the file is valid.');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            const saveCurrentVersion = () => {
                const name = prompt('Enter a name for this backup:', `Backup ${new Date().toLocaleString()}`);
                if (!name) return;

                const version = {
                    name,
                    timestamp: new Date().toISOString(),
                    data: {
                        playerNames: [...playerNames],
                        skillRatings: { ...skillRatings },
                        matchScores: JSON.parse(JSON.stringify(matchScores)),
                        knockoutScores: JSON.parse(JSON.stringify(knockoutScores)),
                        knockoutMaxScore,
                        semiMaxScore,
                        finalMaxScore
                    }
                };

                const newVersions = [version, ...savedVersions].slice(0, 10);
                setSavedVersions(newVersions);
                alert('Backup saved successfully!');
            };

            const loadVersion = (version) => {
                const autoBackup = {
                    name: `Auto-backup before loading ${new Date().toLocaleString()}`,
                    timestamp: new Date().toISOString(),
                    data: {
                        playerNames: [...playerNames],
                        skillRatings: { ...skillRatings },
                        matchScores: JSON.parse(JSON.stringify(matchScores)),
                        knockoutScores: JSON.parse(JSON.stringify(knockoutScores)),
                        knockoutMaxScore,
                        semiMaxScore,
                        finalMaxScore
                    }
                };

                setSavedVersions([autoBackup, ...savedVersions].slice(0, 10));
                
                setPlayerNames(version.data.playerNames);
                setSkillRatings(version.data.skillRatings);
                setMatchScores(JSON.parse(JSON.stringify(version.data.matchScores)));
                setKnockoutScores(JSON.parse(JSON.stringify(version.data.knockoutScores || {})));
                setKnockoutMaxScore(version.data.knockoutMaxScore || 16);
                setSemiMaxScore(version.data.semiMaxScore || 16);
                setFinalMaxScore(version.data.finalMaxScore || 16);
                alert('Version loaded successfully!');
            };

            const deleteVersion = (index) => {
                if (!confirm('Are you sure you want to delete this version?')) return;
                setSavedVersions(savedVersions.filter((_, i) => i !== index));
            };

            const resetAllScores = () => {
                const autoBackup = {
                    name: `Auto-backup before reset ${new Date().toLocaleString()}`,
                    timestamp: new Date().toISOString(),
                    data: {
                        playerNames: [...playerNames],
                        skillRatings: { ...skillRatings },
                        matchScores: JSON.parse(JSON.stringify(matchScores)),
                        knockoutScores: JSON.parse(JSON.stringify(knockoutScores)),
                        knockoutMaxScore,
                        semiMaxScore,
                        finalMaxScore
                    }
                };

                setSavedVersions([autoBackup, ...savedVersions].slice(0, 10));
                setMatchScores({});
                setKnockoutScores({});
                alert('All scores have been reset!');
            };

            // Player Badge Component
            const PlayerBadge = ({ playerNum, showRating = false }) => (
                <span
                    className="inline-flex items-center px-2 py-1 rounded text-white text-sm font-medium"
                    style={{ backgroundColor: getTierColor(playerNum) }}
                    title={`${playerNames[playerNum - 1]} - Rank #${playerNum}, ${getTierName(playerNum)}, Rating: ${skillRatings[playerNum]?.toFixed(2)}`}
                >
                    {playerNames[playerNum - 1]}
                    {showRating && ` (${skillRatings[playerNum]?.toFixed(2)})`}
                </span>
            );

            // Match Display Component
            const MatchDisplay = ({ round, matchIndex, match }) => {
                const [p1, p2, p3, p4] = match;
                const scores = matchScores[round]?.[matchIndex] || {};
                const isComplete = scores.team1Score !== undefined && scores.team1Score !== null;
                
                const team1Rating = skillRatings[p1] + skillRatings[p2];
                const team2Rating = skillRatings[p3] + skillRatings[p4];
                
                const team1Group = Math.ceil(p1 / 4);
                const team2Group = Math.ceil(p3 / 4);
                const isWithinGroup = team1Group === team2Group;
                
                const winner = isComplete
                    ? scores.team1Score > scores.team2Score
                        ? 'team1'
                        : scores.team1Score < scores.team2Score
                        ? 'team2'
                        : 'tie'
                    : null;

                return (
                    <div className={`border-2 rounded-lg p-4 ${isComplete ? 'bg-green-50 border-green-500' : 'bg-white'} ${isWithinGroup ? 'border-purple-300' : 'border-green-300'}`}>
                        <div className="flex justify-between items-center mb-2">
                            <span className="font-bold text-gray-700">Match {matchIndex + 1}</span>
                            <div className="flex gap-2">
                                <span className={`text-xs px-2 py-1 rounded ${isWithinGroup ? 'bg-purple-100 text-purple-800' : 'bg-green-100 text-green-800'}`}>
                                    {isWithinGroup ? 'Within Group' : 'Cross Group'}
                                </span>
                                {isComplete && <span className="text-green-600">‚úì</span>}
                            </div>
                        </div>
                        
                        <div className={`mb-2 p-2 rounded ${winner === 'team1' ? 'bg-green-100' : ''}`}>
                            <div className="flex gap-2 mb-1">
                                <PlayerBadge playerNum={p1} />
                                <PlayerBadge playerNum={p2} />
                            </div>
                            <div className="text-xs text-gray-600">
                                Groups: {team1Group} | Total: {team1Rating.toFixed(2)}
                            </div>
                        </div>

                        <div className="flex items-center justify-center gap-2 my-2">
                            <input
                                type="number"
                                min="0"
                                max="16"
                                value={scores.team1Score ?? ''}
                                onChange={(e) => handleScoreChange(round, matchIndex, 'team1', e.target.value)}
                                className="w-16 px-2 py-1 border rounded text-center"
                                placeholder="0"
                            />
                            <span className="font-bold">-</span>
                            <input
                                type="number"
                                min="0"
                                max="16"
                                value={scores.team2Score ?? ''}
                                onChange={(e) => handleScoreChange(round, matchIndex, 'team2', e.target.value)}
                                className="w-16 px-2 py-1 border rounded text-center"
                                placeholder="0"
                            />
                            {isComplete && (
                                <button
                                    onClick={() => clearMatchScore(round, matchIndex)}
                                    className="text-red-500 hover:text-red-700 ml-2"
                                >
                                    ‚úï
                                </button>
                            )}
                        </div>

                        <div className={`mt-2 p-2 rounded ${winner === 'team2' ? 'bg-green-100' : ''}`}>
                            <div className="flex gap-2 mb-1">
                                <PlayerBadge playerNum={p3} />
                                <PlayerBadge playerNum={p4} />
                            </div>
                            <div className="text-xs text-gray-600">
                                Groups: {team2Group} | Total: {team2Rating.toFixed(2)}
                            </div>
                        </div>

                        {isComplete && winner && (
                            <div className="mt-2 text-center font-bold text-green-700">
                                {winner === 'tie' ? 'ü§ù Draw' : `üèÜ Winner: Team ${winner === 'team1' ? '1' : '2'}`}
                            </div>
                        )}
                    </div>
                );
            };

            // Results Tab Component
            const ResultsTab = () => {
                const standings = [];
                
                for (let p = 1; p <= 24; p++) {
                    let stats = {
                        player: p,
                        matches: 0,
                        wins: 0,
                        draws: 0,
                        losses: 0,
                        pointsFor: 0,
                        pointsAgainst: 0,
                        points: 0
                    };

                    for (let r = 1; r <= 13; r++) {
                        for (let m = 0; m < 6; m++) {
                            const match = fixtures[r - 1][m];
                            if (!match.includes(p)) continue;

                            const scores = matchScores[r]?.[m];
                            if (!scores || scores.team1Score === null) continue;

                            stats.matches++;
                            const isTeam1 = match[0] === p || match[1] === p;
                            const myScore = isTeam1 ? scores.team1Score : scores.team2Score;
                            const oppScore = isTeam1 ? scores.team2Score : scores.team1Score;

                            stats.pointsFor += myScore;
                            stats.pointsAgainst += oppScore;

                            if (myScore > oppScore) {
                                stats.wins++;
                                stats.points += 3;
                            } else if (myScore < oppScore) {
                                stats.losses++;
                            } else {
                                stats.draws++;
                                stats.points += 1;
                            }
                        }
                    }

                    stats.pointsDiff = stats.pointsFor - stats.pointsAgainst;
                    stats.winRate = stats.matches > 0 ? ((stats.wins / stats.matches) * 100).toFixed(1) : '0.0';
                    standings.push(stats);
                }

                standings.sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    if (b.pointsDiff !== a.pointsDiff) return b.pointsDiff - a.pointsDiff;
                    return b.pointsFor - a.pointsFor;
                });

                return (
                    <div className="p-4">
                        <h2 className="text-2xl font-bold mb-4">Player Standings</h2>
                        
                        <div className="bg-blue-50 p-4 rounded-lg mb-4">
                            <h3 className="font-bold mb-2">Tournament Point System</h3>
                            <p className="text-sm">Win: 3 points ‚Ä¢ Draw: 1 point ‚Ä¢ Loss: 0 points</p>
                        </div>

                        <div className="overflow-x-auto">
                            <table className="w-full border-collapse">
                                <thead>
                                    <tr className="bg-gray-200">
                                        <th className="border p-2">Rank</th>
                                        <th className="border p-2">Player</th>
                                        <th className="border p-2">Points</th>
                                        <th className="border p-2">Matches</th>
                                        <th className="border p-2">W</th>
                                        <th className="border p-2">D</th>
                                        <th className="border p-2">L</th>
                                        <th className="border p-2">Win%</th>
                                        <th className="border p-2">For</th>
                                        <th className="border p-2">Against</th>
                                        <th className="border p-2">Diff</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {standings.map((s, idx) => (
                                        <tr key={s.player} className={idx < 3 ? 'bg-yellow-50' : ''}>
                                            <td className="border p-2 text-center">
                                                {idx === 0 && 'ü•á'} {idx === 1 && 'ü•à'} {idx === 2 && 'ü•â'} {idx + 1}
                                            </td>
                                            <td className="border p-2">
                                                <PlayerBadge playerNum={s.player} />
                                            </td>
                                            <td className="border p-2 text-center font-bold text-blue-600 text-lg">{s.points}</td>
                                            <td className="border p-2 text-center">{s.matches}</td>
                                            <td className="border p-2 text-center text-green-600 font-bold">{s.wins}</td>
                                            <td className="border p-2 text-center text-yellow-600">{s.draws}</td>
                                            <td className="border p-2 text-center text-red-600 font-bold">{s.losses}</td>
                                            <td className="border p-2 text-center">{s.winRate}%</td>
                                            <td className="border p-2 text-center">{s.pointsFor}</td>
                                            <td className="border p-2 text-center">{s.pointsAgainst}</td>
                                            <td className={`border p-2 text-center font-bold ${s.pointsDiff > 0 ? 'text-green-600' : s.pointsDiff < 0 ? 'text-red-600' : ''}`}>
                                                {s.pointsDiff > 0 ? '+' : ''}{s.pointsDiff}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            // Render based on active tab
            const renderContent = () => {
                if (activeTab === 'tournament') {
                    const filteredMatches = getFilteredMatches();

                    return (
                        <div className="p-4">
                            <div className="mb-4 flex flex-wrap gap-4">
                                <div>
                                    <label className="block text-sm font-medium mb-1">Filter Round</label>
                                    <select
                                        value={filterRound}
                                        onChange={(e) => setFilterRound(e.target.value)}
                                        className="border rounded px-3 py-2"
                                    >
                                        <option value="all">All Rounds</option>
                                        {Array.from({ length: 13 }, (_, i) => (
                                            <option key={i + 1} value={i + 1}>Round {i + 1}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1">Filter Player</label>
                                    <select
                                        value={filterPlayer}
                                        onChange={(e) => setFilterPlayer(e.target.value)}
                                        className="border rounded px-3 py-2"
                                    >
                                        <option value="all">All Players</option>
                                        {playerNames.map((name, idx) => (
                                            <option key={idx + 1} value={idx + 1}>{name}</option>
                                        ))}
                                    </select>
                                </div>

                                <div className="flex items-end">
                                    <button
                                        onClick={() => { setFilterRound('all'); setFilterPlayer('all'); }}
                                        className="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"
                                    >
                                        Clear Filters
                                    </button>
                                </div>
                            </div>

                            <div className="mb-4">
                                <h3 className="text-sm font-medium mb-2">Quick Round Navigation</h3>
                                <div className="flex flex-wrap gap-2">
                                    {Array.from({ length: 13 }, (_, i) => (
                                        <button
                                            key={i + 1}
                                            onClick={() => {
                                                setSelectedRound(i + 1);
                                                setFilterRound(String(i + 1));
                                            }}
                                            className={`px-3 py-1 rounded transition-transform ${
                                                selectedRound === i + 1
                                                    ? 'bg-blue-500 text-white scale-110'
                                                    : 'bg-gray-200 hover:bg-gray-300'
                                            }`}
                                        >
                                            R{i + 1}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {filteredMatches.map(({ round, matchIndex, match }) => (
                                    <MatchDisplay
                                        key={`${round}-${matchIndex}`}
                                        round={round}
                                        matchIndex={matchIndex}
                                        match={match}
                                    />
                                ))}
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'players') {
                    return (
                        <div className="p-4">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-2xl font-bold">Edit Player Names</h2>
                                <button
                                    onClick={() => setPlayerNames(defaultPlayerNames)}
                                    className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"
                                >
                                    Reset All Names
                                </button>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {playerNames.map((name, idx) => (
                                    <div key={idx} className="border rounded-lg p-4 bg-white">
                                        <div className="flex items-center gap-2 mb-2">
                                            <span
                                                className="px-2 py-1 rounded text-white text-sm font-bold"
                                                style={{ backgroundColor: getTierColor(idx + 1) }}
                                            >
                                                #{idx + 1}
                                            </span>
                                            <span className="text-sm font-medium">{getTierName(idx + 1)}</span>
                                        </div>

                                        <div className="mb-2">
                                            <label className="block text-sm font-medium mb-1">Player Name:</label>
                                            <input
                                                type="text"
                                                value={name}
                                                onChange={(e) => {
                                                    const newNames = [...playerNames];
                                                    newNames[idx] = e.target.value;
                                                    setPlayerNames(newNames);
                                                }}
                                                className="w-full border rounded px-3 py-2"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-1">Skill Rating:</label>
                                            <input
                                                type="number"
                                                step="0.05"
                                                min="0"
                                                max="5"
                                                value={skillRatings[idx + 1] || 0}
                                                onChange={(e) => {
                                                    const val = parseFloat(e.target.value);
                                                    if (val >= 0 && val <= 5) {
                                                        setSkillRatings({ ...skillRatings, [idx + 1]: val });
                                                    }
                                                }}
                                                className="w-full border rounded px-3 py-2"
                                            />
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="mt-6 bg-blue-50 p-4 rounded-lg">
                                <h3 className="font-bold mb-2">üí° Tips</h3>
                                <p className="text-sm">Players are organized into 6 tiers of 4 players each.</p>
                                <p className="text-sm">Skill ratings range from 0-5, used for fairness calculations.</p>
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'data') {
                    return (
                        <div className="p-4">
                            <h2 className="text-2xl font-bold mb-4">Data Management</h2>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div className="border rounded-lg p-4 bg-blue-50">
                                    <h3 className="font-bold mb-2">Export Data</h3>
                                    <button
                                        onClick={exportData}
                                        className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full"
                                    >
                                        Download JSON
                                    </button>
                                </div>

                                <div className="border rounded-lg p-4 bg-purple-50">
                                    <h3 className="font-bold mb-2">Import Data</h3>
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={importData}
                                        className="w-full"
                                    />
                                </div>

                                <div className="border rounded-lg p-4 bg-red-50">
                                    <h3 className="font-bold mb-2">Reset Scores</h3>
                                    <button
                                        onClick={resetAllScores}
                                        className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 w-full"
                                    >
                                        Reset All Scores
                                    </button>
                                </div>

                                <div className="border rounded-lg p-4 bg-green-50">
                                    <h3 className="font-bold mb-2">Save Backup</h3>
                                    <button
                                        onClick={saveCurrentVersion}
                                        className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full"
                                    >
                                        Save Current Version
                                    </button>
                                </div>
                            </div>

                            <div>
                                <h3 className="text-xl font-bold mb-2">Saved Versions ({savedVersions.length}/10)</h3>
                                {savedVersions.length === 0 ? (
                                    <div className="border rounded-lg p-8 text-center text-gray-500">
                                        <div className="text-4xl mb-2">üì¶</div>
                                        <p>No saved versions yet</p>
                                        <p className="text-sm">Click 'Save Backup' to create one</p>
                                    </div>
                                ) : (
                                    <div className="space-y-2">
                                        {savedVersions.map((version, idx) => {
                                            const matchCount = Object.keys(version.data.matchScores).reduce((sum, round) => {
                                                return sum + Object.keys(version.data.matchScores[round]).length;
                                            }, 0);

                                            return (
                                                <div key={idx} className="border rounded-lg p-4 bg-white hover:shadow-lg transition-shadow">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <h4 className="font-bold">{version.name}</h4>
                                                            <p className="text-sm text-gray-600">{new Date(version.timestamp).toLocaleString()}</p>
                                                            <p className="text-sm text-gray-600">{matchCount} matches recorded</p>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => loadVersion(version)}
                                                                className="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm"
                                                            >
                                                                Load
                                                            </button>
                                                            <button
                                                                onClick={() => deleteVersion(idx)}
                                                                className="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm"
                                                            >
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'results') {
                    return <ResultsTab />;
                }

                if (activeTab === 'fairness') {
                    const fairnessData = [];
                    
                    for (let p = 1; p <= 24; p++) {
                        let data = {
                            player: p,
                            rating: skillRatings[p],
                            rounds: [],
                            total: 0,
                            avg: 0,
                            hardest: { round: null, value: Infinity },
                            easiest: { round: null, value: -Infinity }
                        };

                        for (let r = 1; r <= 13; r++) {
                            for (let m = 0; m < 6; m++) {
                                const match = fixtures[r - 1][m];
                                if (!match.includes(p)) continue;

                                const isTeam1 = match[0] === p || match[1] === p;
                                const teamRating = isTeam1 
                                    ? skillRatings[match[0]] + skillRatings[match[1]]
                                    : skillRatings[match[2]] + skillRatings[match[3]];
                                const oppRating = isTeam1
                                    ? skillRatings[match[2]] + skillRatings[match[3]]
                                    : skillRatings[match[0]] + skillRatings[match[1]];
                                
                                const fairness = teamRating - oppRating;
                                data.rounds.push(fairness);
                                data.total += fairness;

                                if (fairness < data.hardest.value) {
                                    data.hardest = { round: r, value: fairness };
                                }
                                if (fairness > data.easiest.value) {
                                    data.easiest = { round: r, value: fairness };
                                }
                            }
                        }

                        data.avg = data.total / 13;
                        fairnessData.push(data);
                    }

                    fairnessData.sort((a, b) => a.total - b.total);

                    const getFairnessColor = (value) => {
                        if (value < -0.5) return 'bg-red-200 text-red-800';
                        if (value < 0) return 'bg-red-100 text-red-700';
                        if (value === 0) return 'bg-gray-200 text-gray-700';
                        if (value < 0.5) return 'bg-green-100 text-green-700';
                        return 'bg-green-200 text-green-800';
                    };

                    const harder = fairnessData.filter(d => d.total < -1).length;
                    const balanced = fairnessData.filter(d => d.total >= -1 && d.total <= 1).length;
                    const easier = fairnessData.filter(d => d.total > 1).length;

                    return (
                        <div className="p-4">
                            <h2 className="text-2xl font-bold mb-4">Fairness Analysis</h2>
                            
                            <div className="bg-blue-50 p-4 rounded-lg mb-4">
                                <h3 className="font-bold mb-2">How Fairness is Calculated</h3>
                                <p className="text-sm mb-1">Fairness Score = Your Team Rating - Opponent Team Rating</p>
                                <p className="text-sm"><strong>Negative score:</strong> Faced harder opponents</p>
                                <p className="text-sm"><strong>Positive score:</strong> Faced easier opponents</p>
                                <p className="text-sm"><strong>Zero score:</strong> Perfectly balanced match</p>
                            </div>

                            <div className="overflow-x-auto mb-4">
                                <table className="w-full border-collapse text-sm">
                                    <thead>
                                        <tr className="bg-gray-200">
                                            <th className="border p-2">Player</th>
                                            <th className="border p-2">Rating</th>
                                            <th className="border p-2">Total Fair</th>
                                            <th className="border p-2">Avg Fair</th>
                                            <th className="border p-2">Hardest Round</th>
                                            <th className="border p-2">Easiest Round</th>
                                            <th className="border p-2">All Rounds</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {fairnessData.map((d) => (
                                            <tr key={d.player}>
                                                <td className="border p-2">
                                                    <PlayerBadge playerNum={d.player} />
                                                </td>
                                                <td className="border p-2 text-center">{d.rating.toFixed(2)}</td>
                                                <td className={`border p-2 text-center font-bold ${getFairnessColor(d.total)}`}>
                                                    {d.total.toFixed(2)}
                                                </td>
                                                <td className="border p-2 text-center">{d.avg.toFixed(2)}</td>
                                                <td className="border p-2 text-center">
                                                    <span title={`Round ${d.hardest.round}: ${d.hardest.value.toFixed(2)}`}>
                                                        R{d.hardest.round} ({d.hardest.value.toFixed(2)})
                                                    </span>
                                                </td>
                                                <td className="border p-2 text-center">
                                                    <span title={`Round ${d.easiest.round}: ${d.easiest.value.toFixed(2)}`}>
                                                        R{d.easiest.round} ({d.easiest.value.toFixed(2)})
                                                    </span>
                                                </td>
                                                <td className="border p-2">
                                                    <div className="flex gap-1 flex-wrap">
                                                        {d.rounds.map((val, idx) => (
                                                            <span
                                                                key={idx}
                                                                className={`px-1 text-xs rounded ${getFairnessColor(val)}`}
                                                                title={`Round ${idx + 1}: ${val.toFixed(2)}`}
                                                            >
                                                                {val.toFixed(1)}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>

                            <div className="grid grid-cols-3 gap-4">
                                <div className="bg-red-50 border-2 border-red-300 rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-red-700">{harder}</div>
                                    <div className="text-sm">Harder Schedule</div>
                                    <div className="text-xs text-gray-600">(Total &lt; -1)</div>
                                </div>
                                <div className="bg-gray-50 border-2 border-gray-300 rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-gray-700">{balanced}</div>
                                    <div className="text-sm">Balanced</div>
                                    <div className="text-xs text-gray-600">(-1 to +1)</div>
                                </div>
                                <div className="bg-green-50 border-2 border-green-300 rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-green-700">{easier}</div>
                                    <div className="text-sm">Easier Schedule</div>
                                    <div className="text-xs text-gray-600">(Total &gt; +1)</div>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'fairness2') {
                    const fairness2Data = [];
                    
                    for (let p = 1; p <= 24; p++) {
                        let data = {
                            player: p,
                            rating: skillRatings[p],
                            rounds: [],
                            total: 0,
                            avg: 0,
                            hardest: { round: null, value: Infinity, partner: null, opponents: [] },
                            easiest: { round: null, value: -Infinity, partner: null, opponents: [] }
                        };

                        for (let r = 1; r <= 13; r++) {
                            for (let m = 0; m < 6; m++) {
                                const match = fixtures[r - 1][m];
                                if (!match.includes(p)) continue;

                                const isTeam1 = match[0] === p || match[1] === p;
                                const partner = isTeam1 
                                    ? (match[0] === p ? match[1] : match[0])
                                    : (match[2] === p ? match[3] : match[2]);
                                const opponents = isTeam1 ? [match[2], match[3]] : [match[0], match[1]];
                                
                                const partnerRating = skillRatings[partner];
                                const avgOppRating = (skillRatings[opponents[0]] + skillRatings[opponents[1]]) / 2;
                                
                                const fairness = partnerRating - avgOppRating;
                                data.rounds.push(fairness);
                                data.total += fairness;

                                if (fairness < data.hardest.value) {
                                    data.hardest = { round: r, value: fairness, partner, opponents };
                                }
                                if (fairness > data.easiest.value) {
                                    data.easiest = { round: r, value: fairness, partner, opponents };
                                }
                            }
                        }

                        data.avg = data.total / 13;
                        fairness2Data.push(data);
                    }

                    fairness2Data.sort((a, b) => a.total - b.total);

                    const getFairnessColor = (value) => {
                        if (value < -0.5) return 'bg-red-200 text-red-800';
                        if (value < 0) return 'bg-red-100 text-red-700';
                        if (value === 0) return 'bg-gray-200 text-gray-700';
                        if (value < 0.5) return 'bg-green-100 text-green-700';
                        return 'bg-green-200 text-green-800';
                    };

                    const harder = fairness2Data.filter(d => d.total < -1).length;
                    const balanced = fairness2Data.filter(d => d.total >= -1 && d.total <= 1).length;
                    const easier = fairness2Data.filter(d => d.total > 1).length;

                    return (
                        <div className="p-4">
                            <h2 className="text-2xl font-bold mb-4">Fairness Analysis 2</h2>
                            
                            <div className="bg-purple-50 p-4 rounded-lg mb-4">
                                <h3 className="font-bold mb-2">How Fairness 2 is Calculated</h3>
                                <p className="text-sm mb-1">Fairness Score = Partner Rating - Average Opponent Rating</p>
                                <p className="text-sm"><strong>Negative score:</strong> Partner weaker than average opponent</p>
                                <p className="text-sm"><strong>Positive score:</strong> Partner stronger than average opponent</p>
                            </div>

                            <div className="overflow-x-auto mb-4">
                                <table className="w-full border-collapse text-sm">
                                    <thead>
                                        <tr className="bg-purple-200">
                                            <th className="border p-2">Player</th>
                                            <th className="border p-2">Rating</th>
                                            <th className="border p-2">Total Fair</th>
                                            <th className="border p-2">Avg Fair</th>
                                            <th className="border p-2">Hardest Round</th>
                                            <th className="border p-2">Easiest Round</th>
                                            <th className="border p-2">All Rounds</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {fairness2Data.map((d) => (
                                            <tr key={d.player}>
                                                <td className="border p-2">
                                                    <PlayerBadge playerNum={d.player} />
                                                </td>
                                                <td className="border p-2 text-center">{d.rating.toFixed(2)}</td>
                                                <td className={`border p-2 text-center font-bold ${getFairnessColor(d.total)}`}>
                                                    {d.total.toFixed(2)}
                                                </td>
                                                <td className="border p-2 text-center">{d.avg.toFixed(2)}</td>
                                                <td className="border p-2 text-center">
                                                    <span title={`Round ${d.hardest.round}: Partner ${playerNames[d.hardest.partner - 1]}, ${d.hardest.value.toFixed(2)}`}>
                                                        R{d.hardest.round} ({d.hardest.value.toFixed(2)})
                                                    </span>
                                                </td>
                                                <td className="border p-2 text-center">
                                                    <span title={`Round ${d.easiest.round}: Partner ${playerNames[d.easiest.partner - 1]}, ${d.easiest.value.toFixed(2)}`}>
                                                        R{d.easiest.round} ({d.easiest.value.toFixed(2)})
                                                    </span>
                                                </td>
                                                <td className="border p-2">
                                                    <div className="flex gap-1 flex-wrap">
                                                        {d.rounds.map((val, idx) => (
                                                            <span
                                                                key={idx}
                                                                className={`px-1 text-xs rounded ${getFairnessColor(val)}`}
                                                                title={`Round ${idx + 1}: ${val.toFixed(2)}`}
                                                            >
                                                                {val.toFixed(1)}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>

                            <div className="grid grid-cols-3 gap-4">
                                <div className="bg-red-50 border-2 border-red-300 rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-red-700">{harder}</div>
                                    <div className="text-sm">Weaker Partners</div>
                                    <div className="text-xs text-gray-600">(Total &lt; -1)</div>
                                </div>
                                <div className="bg-gray-50 border-2 border-gray-300 rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-gray-700">{balanced}</div>
                                    <div className="text-sm">Balanced</div>
                                    <div className="text-xs text-gray-600">(-1 to +1)</div>
                                </div>
                                <div className="bg-green-50 border-2 border-green-300 rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-green-700">{easier}</div>
                                    <div className="text-sm">Stronger Partners</div>
                                    <div className="text-xs text-gray-600">(Total &gt; +1)</div>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'partnerships') {
                    const partnerships = Array(25).fill(null).map(() => Array(25).fill(0));
                    const opponents = Array(25).fill(null).map(() => Array(25).fill(0));

                    for (let r = 1; r <= 13; r++) {
                        for (let m = 0; m < 6; m++) {
                            const [p1, p2, p3, p4] = fixtures[r - 1][m];
                            partnerships[p1][p2]++;
                            partnerships[p2][p1]++;
                            partnerships[p3][p4]++;
                            partnerships[p4][p3]++;

                            opponents[p1][p3]++;
                            opponents[p1][p4]++;
                            opponents[p2][p3]++;
                            opponents[p2][p4]++;
                            opponents[p3][p1]++;
                            opponents[p3][p2]++;
                            opponents[p4][p1]++;
                            opponents[p4][p2]++;
                        }
                    }

                    let uniquePartnerships = 0;
                    let totalPartnerships = 0;
                    let uniqueOpponents = 0;
                    let totalOpponents = 0;

                    for (let i = 1; i <= 24; i++) {
                        for (let j = i + 1; j <= 24; j++) {
                            if (partnerships[i][j] > 0) {
                                uniquePartnerships++;
                                totalPartnerships += partnerships[i][j];
                            }
                            if (opponents[i][j] > 0) {
                                uniqueOpponents++;
                                totalOpponents += opponents[i][j];
                            }
                        }
                    }

                    const getPartnershipColor = (count) => {
                        if (count === 0) return 'bg-white';
                        if (count === 1) return 'bg-blue-100';
                        if (count === 2) return 'bg-green-300';
                        return 'bg-red-300';
                    };

                    const getOpponentColor = (count) => {
                        if (count === 0) return 'bg-white';
                        if (count === 1) return 'bg-red-100';
                        if (count === 2) return 'bg-red-200';
                        if (count === 3) return 'bg-orange-200';
                        if (count === 4) return 'bg-orange-300';
                        if (count === 5) return 'bg-yellow-200';
                        if (count === 6) return 'bg-yellow-300';
                        return 'bg-purple-300';
                    };

                    return (
                        <div className="p-4">
                            <h2 className="text-2xl font-bold mb-4">Partnership & Opponent Analysis</h2>

                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div className="bg-blue-50 border rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-blue-700">{totalPartnerships}</div>
                                    <div className="text-sm">Total Partnerships</div>
                                </div>
                                <div className="bg-green-50 border rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-green-700">{uniquePartnerships}</div>
                                    <div className="text-sm">Unique Partnerships</div>
                                </div>
                                <div className="bg-orange-50 border rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-orange-700">{totalOpponents}</div>
                                    <div className="text-sm">Total Opponent Pairs</div>
                                </div>
                                <div className="bg-purple-50 border rounded-lg p-4 text-center">
                                    <div className="text-3xl font-bold text-purple-700">{uniqueOpponents}</div>
                                    <div className="text-sm">Unique Opponent Pairs</div>
                                </div>
                            </div>

                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-2">Partnership Frequency Matrix</h3>
                                <div className="overflow-x-auto">
                                    <table className="border-collapse text-xs">
                                        <thead>
                                            <tr>
                                                <th className="border p-1 bg-gray-200 sticky left-0"></th>
                                                {Array.from({ length: 24 }, (_, i) => (
                                                    <th key={i} className="border p-1 bg-gray-200">
                                                        <div style={{ writingMode: 'vertical-rl', transform: 'rotate(180deg)' }}>
                                                            P{i + 1}
                                                        </div>
                                                    </th>
                                                ))}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {Array.from({ length: 24 }, (_, i) => (
                                                <tr key={i}>
                                                    <td className="border p-1 bg-gray-200 font-bold sticky left-0">P{i + 1}</td>
                                                    {Array.from({ length: 24 }, (_, j) => (
                                                        <td
                                                            key={j}
                                                            className={`border p-1 text-center ${
                                                                i === j ? 'bg-gray-300' : getPartnershipColor(partnerships[i + 1][j + 1])
                                                            }`}
                                                        >
                                                            {i === j ? '-' : partnerships[i + 1][j + 1] || ''}
                                                        </td>
                                                    ))}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <div className="flex gap-4 mt-2 text-xs">
                                    <span className="flex items-center gap-1">
                                        <div className="w-4 h-4 bg-blue-100 border"></div> 1x
                                    </span>
                                    <span className="flex items-center gap-1">
                                        <div className="w-4 h-4 bg-green-300 border"></div> 2x
                                    </span>
                                    <span className="flex items-center gap-1">
                                        <div className="w-4 h-4 bg-red-300 border"></div> 3+
                                    </span>
                                </div>
                            </div>

                            <div>
                                <h3 className="text-xl font-bold mb-2">Opponent Frequency Matrix</h3>
                                <div className="overflow-x-auto">
                                    <table className="border-collapse text-xs">
                                        <thead>
                                            <tr>
                                                <th className="border p-1 bg-gray-200 sticky left-0"></th>
                                                {Array.from({ length: 24 }, (_, i) => (
                                                    <th key={i} className="border p-1 bg-gray-200">
                                                        <div style={{ writingMode: 'vertical-rl', transform: 'rotate(180deg)' }}>
                                                            P{i + 1}
                                                        </div>
                                                    </th>
                                                ))}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {Array.from({ length: 24 }, (_, i) => (
                                                <tr key={i}>
                                                    <td className="border p-1 bg-gray-200 font-bold sticky left-0">P{i + 1}</td>
                                                    {Array.from({ length: 24 }, (_, j) => (
                                                        <td
                                                            key={j}
                                                            className={`border p-1 text-center ${
                                                                i === j ? 'bg-gray-300' : getOpponentColor(opponents[i + 1][j + 1])
                                                            }`}
                                                        >
                                                            {i === j ? '-' : opponents[i + 1][j + 1] || ''}
                                                        </td>
                                                    ))}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <div className="flex gap-2 mt-2 text-xs flex-wrap">
                                    <span className="flex items-center gap-1">
                                        <div className="w-4 h-4 bg-red-100 border"></div> 1-2x
                                    </span>
                                    <span className="flex items-center gap-1">
                                        <div className="w-4 h-4 bg-orange-200 border"></div> 3-4x
                                    </span>
                                    <span className="flex items-center gap-1">
                                        <div className="w-4 h-4 bg-yellow-200 border"></div> 5-6x
                                    </span>
                                    <span className="flex items-center gap-1">
                                        <div className="w-4 h-4 bg-purple-300 border"></div> 7+
                                    </span>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'knockout') {
                    // Calculate standings for top 12
                    const standings = [];
                    for (let p = 1; p <= 24; p++) {
                        let stats = { player: p, matches: 0, wins: 0, draws: 0, losses: 0, pointsFor: 0, pointsAgainst: 0, points: 0 };
                        for (let r = 1; r <= 13; r++) {
                            for (let m = 0; m < 6; m++) {
                                const match = fixtures[r - 1][m];
                                if (!match.includes(p)) continue;
                                const scores = matchScores[r]?.[m];
                                if (!scores || scores.team1Score === null) continue;
                                stats.matches++;
                                const isTeam1 = match[0] === p || match[1] === p;
                                const myScore = isTeam1 ? scores.team1Score : scores.team2Score;
                                const oppScore = isTeam1 ? scores.team2Score : scores.team1Score;
                                stats.pointsFor += myScore;
                                stats.pointsAgainst += oppScore;
                                if (myScore > oppScore) { stats.wins++; stats.points += 3; }
                                else if (myScore < oppScore) { stats.losses++; }
                                else { stats.draws++; stats.points += 1; }
                            }
                        }
                        stats.pointsDiff = stats.pointsFor - stats.pointsAgainst;
                        standings.push(stats);
                    }
                    standings.sort((a, b) => {
                        if (b.points !== a.points) return b.points - a.points;
                        if (b.pointsDiff !== a.pointsDiff) return b.pointsDiff - a.pointsDiff;
                        return b.pointsFor - a.pointsFor;
                    });

                    const top12 = standings.slice(0, 12);
                    const qualified = top12.length === 12 && top12.every(s => s.matches > 0);

                    const handleKnockoutScore = (matchId, team, value, maxScore) => {
                        const score = value === '' ? null : parseInt(value);
                        if (score !== null && (score < 0 || score > maxScore)) return;
                        const newScores = { ...knockoutScores };
                        if (!newScores[matchId]) newScores[matchId] = {};
                        if (team === 'team1') {
                            newScores[matchId].team1Score = score;
                            newScores[matchId].team2Score = score !== null ? maxScore - score : null;
                        } else {
                            newScores[matchId].team2Score = score;
                            newScores[matchId].team1Score = score !== null ? maxScore - score : null;
                        }
                        setKnockoutScores(newScores);
                    };

                    const clearKnockoutScore = (matchId) => {
                        const newScores = { ...knockoutScores };
                        delete newScores[matchId];
                        setKnockoutScores(newScores);
                    };

                    const getWinner = (matchId) => {
                        const scores = knockoutScores[matchId];
                        if (!scores || scores.team1Score === null) return null;
                        if (scores.team1Score > scores.team2Score) return 'team1';
                        if (scores.team2Score > scores.team1Score) return 'team2';
                        return 'tie';
                    };

                    const KnockoutMatch = ({ title, team1Players, team2Players, matchId, subtitle, maxScore, disabled = false }) => {
                        if (disabled || !team1Players || !team2Players) {
                            return (
                                <div className="border-2 border-gray-300 rounded-lg p-4 bg-gray-50">
                                    <div className="text-center text-gray-500">
                                        <div className="font-bold mb-2">{title}</div>
                                        <div className="text-sm">{subtitle || 'Complete previous matches first'}</div>
                                    </div>
                                </div>
                            );
                        }

                        const scores = knockoutScores[matchId] || {};
                        const isComplete = scores.team1Score !== undefined && scores.team1Score !== null;
                        const winner = getWinner(matchId);

                        return (
                            <div className={`border-2 rounded-lg p-4 ${isComplete ? 'border-green-500 bg-green-50' : 'bg-white border-gray-300'}`}>
                                <div className="flex justify-between items-center mb-2">
                                    <div>
                                        <div className="font-bold">{title}</div>
                                        {subtitle && <div className="text-xs text-gray-600">{subtitle}</div>}
                                    </div>
                                    {isComplete && <span className="text-green-600">‚úì</span>}
                                </div>

                                <div className={`mb-2 p-2 rounded ${winner === 'team1' ? 'bg-green-100 border-2 border-green-500' : ''}`}>
                                    <div className="flex gap-2 mb-1">
                                        <PlayerBadge playerNum={team1Players[0]} />
                                        <PlayerBadge playerNum={team1Players[1]} />
                                    </div>
                                    {winner === 'team1' && <div className="text-green-700 font-bold">üèÜ Winners</div>}
                                </div>

                                <div className="flex items-center justify-center gap-2 my-2">
                                    <input
                                        type="number"
                                        min="0"
                                        max={maxScore}
                                        value={scores.team1Score ?? ''}
                                        onChange={(e) => handleKnockoutScore(matchId, 'team1', e.target.value, maxScore)}
                                        className="w-16 px-2 py-1 border rounded text-center"
                                        placeholder="0"
                                    />
                                    <span className="font-bold">-</span>
                                    <input
                                        type="number"
                                        min="0"
                                        max={maxScore}
                                        value={scores.team2Score ?? ''}
                                        onChange={(e) => handleKnockoutScore(matchId, 'team2', e.target.value, maxScore)}
                                        className="w-16 px-2 py-1 border rounded text-center"
                                        placeholder="0"
                                    />
                                    {isComplete && (
                                        <button
                                            onClick={() => clearKnockoutScore(matchId)}
                                            className="text-red-500 hover:text-red-700 ml-2"
                                        >
                                            ‚úï
                                        </button>
                                    )}
                                </div>

                                <div className={`mt-2 p-2 rounded ${winner === 'team2' ? 'bg-green-100 border-2 border-green-500' : ''}`}>
                                    <div className="flex gap-2 mb-1">
                                        <PlayerBadge playerNum={team2Players[0]} />
                                        <PlayerBadge playerNum={team2Players[1]} />
                                    </div>
                                    {winner === 'team2' && <div className="text-green-700 font-bold">üèÜ Winners</div>}
                                </div>
                            </div>
                        );
                    };

                    if (!qualified) {
                        return (
                            <div className="p-4">
                                <h2 className="text-2xl font-bold mb-4">Knockout Stage</h2>
                                <div className="bg-gray-50 border-2 border-gray-300 rounded-lg p-12 text-center">
                                    <div className="text-6xl mb-4">üèÜ</div>
                                    <h3 className="text-xl font-bold mb-2">Complete the Round Robin Stage First</h3>
                                    <p className="text-gray-600">Top 12 players will qualify for playoffs</p>
                                </div>
                                <div className="mt-6 bg-blue-50 p-4 rounded-lg">
                                    <h3 className="font-bold mb-2">Knockout Stage Scoring Configuration</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Quarter Finals Max Score:</label>
                                            <select
                                                value={knockoutMaxScore}
                                                onChange={(e) => setKnockoutMaxScore(parseInt(e.target.value))}
                                                className="w-full border rounded px-3 py-2"
                                            >
                                                {Array.from({ length: 17 }, (_, i) => i + 8).map(n => (
                                                    <option key={n} value={n}>{n}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Semi Finals Max Score:</label>
                                            <select
                                                value={semiMaxScore}
                                                onChange={(e) => setSemiMaxScore(parseInt(e.target.value))}
                                                className="w-full border rounded px-3 py-2"
                                            >
                                                {Array.from({ length: 17 }, (_, i) => i + 8).map(n => (
                                                    <option key={n} value={n}>{n}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Final Max Score:</label>
                                            <select
                                                value={finalMaxScore}
                                                onChange={(e) => setFinalMaxScore(parseInt(e.target.value))}
                                                className="w-full border rounded px-3 py-2"
                                            >
                                                {Array.from({ length: 17 }, (_, i) => i + 8).map(n => (
                                                    <option key={n} value={n}>{n}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    }

                    // Get qualified players
                    const p1 = top12[0].player;
                    const p2 = top12[1].player;
                    const p3 = top12[2].player;
                    const p4 = top12[3].player;
                    const p5 = top12[4].player;
                    const p6 = top12[5].player;
                    const p7 = top12[6].player;
                    const p8 = top12[7].player;
                    const p9 = top12[8].player;
                    const p10 = top12[9].player;
                    const p11 = top12[10].player;
                    const p12 = top12[11].player;

                    // Determine QF winners
                    const qf1Winner = getWinner('qf1');
                    const qf2Winner = getWinner('qf2');
                    const qf3Winner = getWinner('qf3');
                    const qf4Winner = getWinner('qf4');

                    const qf1WinnerPlayers = qf1Winner === 'team1' ? [p1, p3] : qf1Winner === 'team2' ? [p12, p10] : null;
                    const qf4WinnerPlayers = qf4Winner === 'team1' ? [p6, p8] : qf4Winner === 'team2' ? [p9, p11] : null;
                    const qf2WinnerPlayers = qf2Winner === 'team1' ? [p2, p4] : qf2Winner === 'team2' ? [p12, p10] : null;
                    const qf3WinnerPlayers = qf3Winner === 'team1' ? [p5, p7] : qf3Winner === 'team2' ? [p10, p12] : null;

                    // Determine SF winners
                    const sf1Winner = getWinner('sf1');
                    const sf2Winner = getWinner('sf2');

                    const sf1WinnerPlayers = sf1Winner === 'team1' ? qf1WinnerPlayers : sf1Winner === 'team2' ? qf4WinnerPlayers : null;
                    const sf2WinnerPlayers = sf2Winner === 'team1' ? qf2WinnerPlayers : sf2Winner === 'team2' ? qf3WinnerPlayers : null;

                    const finalWinner = getWinner('final');

                    return (
                        <div className="p-4">
                            <h2 className="text-2xl font-bold mb-4">üèÜ Knockout Stage - Top 12 Players</h2>

                            <div className="mb-4 bg-blue-50 p-4 rounded-lg">
                                <h3 className="font-bold mb-2">Scoring Configuration</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">QF Max:</label>
                                        <select
                                            value={knockoutMaxScore}
                                            onChange={(e) => setKnockoutMaxScore(parseInt(e.target.value))}
                                            className="w-full border rounded px-2 py-1"
                                        >
                                            {Array.from({ length: 17 }, (_, i) => i + 8).map(n => (
                                                <option key={n} value={n}>{n}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">SF Max:</label>
                                        <select
                                            value={semiMaxScore}
                                            onChange={(e) => setSemiMaxScore(parseInt(e.target.value))}
                                            className="w-full border rounded px-2 py-1"
                                        >
                                            {Array.from({ length: 17 }, (_, i) => i + 8).map(n => (
                                                <option key={n} value={n}>{n}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Final Max:</label>
                                        <select
                                            value={finalMaxScore}
                                            onChange={(e) => setFinalMaxScore(parseInt(e.target.value))}
                                            className="w-full border rounded px-2 py-1"
                                        >
                                            {Array.from({ length: 17 }, (_, i) => i + 8).map(n => (
                                                <option key={n} value={n}>{n}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div className="mb-4">
                                <h3 className="font-bold mb-2">Qualified Players (Seeded by Standings)</h3>
                                <div className="flex flex-wrap gap-2">
                                    {top12.map((s, idx) => (
                                        <div key={s.player} className="bg-gradient-to-r from-yellow-100 to-yellow-200 border-2 border-yellow-400 rounded px-3 py-2">
                                            <div className="text-xs font-bold text-yellow-800">#{idx + 1}</div>
                                            <PlayerBadge playerNum={s.player} />
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="mb-6">
                                <h3 className="text-xl font-bold mb-3">Quarter Finals</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <KnockoutMatch
                                        title="QF1"
                                        subtitle="1st/3rd vs 12th/10th"
                                        team1Players={[p1, p3]}
                                        team2Players={[p12, p10]}
                                        matchId="qf1"
                                        maxScore={knockoutMaxScore}
                                    />
                                    <KnockoutMatch
                                        title="QF2"
                                        subtitle="2nd/4th vs 11th/9th"
                                        team1Players={[p2, p4]}
                                        team2Players={[p11, p9]}
                                        matchId="qf2"
                                        maxScore={knockoutMaxScore}
                                    />
                                    <KnockoutMatch
                                        title="QF3"
                                        subtitle="5th/7th vs 10th/12th"
                                        team1Players={[p5, p7]}
                                        team2Players={[p10, p12]}
                                        matchId="qf3"
                                        maxScore={knockoutMaxScore}
                                    />
                                    <KnockoutMatch
                                        title="QF4"
                                        subtitle="6th/8th vs 9th/11th"
                                        team1Players={[p6, p8]}
                                        team2Players={[p9, p11]}
                                        matchId="qf4"
                                        maxScore={knockoutMaxScore}
                                    />
                                </div>
                            </div>

                            <div className="mb-6">
                                <h3 className="text-xl font-bold mb-3">Semi Finals</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <KnockoutMatch
                                        title="SF1"
                                        subtitle="Winner QF1 vs Winner QF4"
                                        team1Players={qf1WinnerPlayers}
                                        team2Players={qf4WinnerPlayers}
                                        matchId="sf1"
                                        maxScore={semiMaxScore}
                                        disabled={!qf1Winner || !qf4Winner}
                                    />
                                    <KnockoutMatch
                                        title="SF2"
                                        subtitle="Winner QF2 vs Winner QF3"
                                        team1Players={qf2WinnerPlayers}
                                        team2Players={qf3WinnerPlayers}
                                        matchId="sf2"
                                        maxScore={semiMaxScore}
                                        disabled={!qf2Winner || !qf3Winner}
                                    />
                                </div>
                            </div>

                            <div>
                                <h3 className="text-xl font-bold mb-3">üèÜ FINAL üèÜ</h3>
                                <div className="max-w-2xl mx-auto">
                                    <KnockoutMatch
                                        title="CHAMPIONSHIP FINAL"
                                        subtitle="Winner SF1 vs Winner SF2"
                                        team1Players={sf1WinnerPlayers}
                                        team2Players={sf2WinnerPlayers}
                                        matchId="final"
                                        maxScore={finalMaxScore}
                                        disabled={!sf1Winner || !sf2Winner}
                                    />
                                </div>

                                {finalWinner && (
                                    <div className="mt-6 bg-gradient-to-r from-yellow-100 to-yellow-200 border-4 border-yellow-500 rounded-lg p-8 text-center">
                                        <div className="text-5xl mb-3">üéâ üèÜ üéâ</div>
                                        <h3 className="text-2xl font-bold mb-3">TOURNAMENT CHAMPIONS!</h3>
                                        <div className="flex gap-3 justify-center">
                                            {(finalWinner === 'team1' ? sf1WinnerPlayers : sf2WinnerPlayers).map(p => (
                                                <div key={p} className="bg-white rounded-lg p-3 shadow-lg">
                                                    <PlayerBadge playerNum={p} />
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                }

                return <div className="p-4">Tab content coming soon...</div>;
            };

            return (
                <div className="min-h-screen bg-gray-100">
                    <header className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 shadow-lg">
                        <h1 className="text-3xl font-bold">üèì Padel Tournament</h1>
                        <p className="text-sm opacity-90">24 Players ‚Ä¢ 13 Rounds ‚Ä¢ Fairness-Optimized Competition</p>
                    </header>

                    <nav className="bg-white shadow-md p-2">
                        <div className="flex flex-wrap gap-2">
                            {[
                                { id: 'tournament', label: 'üèÜ Tournament' },
                                { id: 'players', label: 'üë• Players' },
                                { id: 'data', label: 'üíæ Data' },
                                { id: 'results', label: 'üìä Results' },
                                { id: 'fairness', label: '‚öñÔ∏è Fairness' },
                                { id: 'fairness2', label: '‚öñÔ∏è Fairness 2' },
                                { id: 'partnerships', label: 'ü§ù Partnerships' },
                                { id: 'knockout', label: 'üèÜ Knockout' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`px-4 py-2 rounded transition-colors ${
                                        activeTab === tab.id
                                            ? 'bg-blue-500 text-white'
                                            : 'bg-gray-200 hover:bg-gray-300'
                                    }`}
                                >
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </nav>

                    <main className="container mx-auto">
                        {renderContent()}
                    </main>
                </div>
            );
        }

        ReactDOM.render(<PadelTournamentApp />, document.getElementById('root'));
    </script>
</body>
</html>
